<!--index.wxml-->
<view class="container">
  <!-- å„¿ç«¥ä¿¡æ¯å’Œåˆ‡æ¢ -->
  <view class="child-section">
    <view class="child-info" bindtap="switchChild">
      <text class="child-name">{{currentChild?.name || 'æœªé€‰æ‹©'}}</text>
      <text class="switch-icon">â–¶</text>
    </view>
    
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-cards">
      <view class="stat-card">
        <text class="stat-label">æ”¶å…¥</text>
        <text class="stat-value income">Â¥{{statistics.income}}</text>
      </view>
      <view class="stat-card">
        <text class="stat-label">æ”¯å‡º</text>
        <text class="stat-value expense">Â¥{{statistics.expense}}</text>
      </view>
      <view class="stat-card highlight">
        <text class="stat-label">ä½™é¢</text>
        <text class="stat-value balance">Â¥{{statistics.balance}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
  <view class="time-range">
    <text 
      class="range-item {{timeRange === 'day' ? 'active' : ''}}" 
      bindtap="changeTimeRange"
      data-range="day"
    >
      æ—¥
    </text>
    <text 
      class="range-item {{timeRange === 'week' ? 'active' : ''}}" 
      bindtap="changeTimeRange"
      data-range="week"
    >
      å‘¨
    </text>
    <text 
      class="range-item {{timeRange === 'month' ? 'active' : ''}}" 
      bindtap="changeTimeRange"
      data-range="month"
    >
      æœˆ
    </text>
    <text 
      class="range-item {{timeRange === 'year' ? 'active' : ''}}" 
      bindtap="changeTimeRange"
      data-range="year"
    >
      å¹´
    </text>
  </view>

  <!-- å›¾è¡¨åŒºåŸŸ -->
  <view class="chart-section">
    <view class="section-title">æ”¯å‡ºåˆ†ç±»ç»Ÿè®¡</view>
    <view class="chart-container">
      <canvas 
        canvas-id="categoryChart" 
        style="width: {{chartWidth}}px; height: {{chartHeight}}px;" 
      ></canvas>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading-overlay">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>
      
      <!-- æ— æ•°æ®çŠ¶æ€ -->
      <view wx:elif="{{categoryData.length === 0}}" class="no-data">
        <text class="no-data-icon">ğŸ“Š</text>
        <text class="no-data-text">æš‚æ— ç»Ÿè®¡æ•°æ®</text>
      </view>
    </view>
    
    <!-- åˆ†ç±»åˆ—è¡¨ -->
    <view class="category-list">
      <view class="category-item" wx:for="{{categoryData}}" wx:key="index">
        <view class="category-left">
          <view class="category-color" style="background-color: {{item.color}}"></view>
          <text class="category-name">{{item.name}}</text>
        </view>
        <text class="category-value">Â¥{{item.value}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn" bindtap="viewDetailedReport">
      <text class="btn-icon">ğŸ“‹</text>
      <text class="btn-text">è¯¦ç»†æŠ¥è¡¨</text>
    </button>
    <button class="action-btn" bindtap="exportData">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">å¯¼å‡ºæ•°æ®</text>
    </button>
  </view>
</view>