<!--index.wxml-->
<view class="container">
  <!-- å„¿ç«¥ä¿¡æ¯å’Œåˆ‡æ¢ -->
  <view class="child-info" bindtap="switchChild">
    <text class="child-name">{{currentChild?.name || 'æœªé€‰æ‹©'}}</text>
    <text class="switch-icon">â–¶</text>
  </view>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
  <view class="tab-container">
    <view class="tab-bar">
      <view 
        class="tab-item {{activeTab === 'todo' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="todo"
      >
        <text class="tab-text">å¾…å®Œæˆä»»åŠ¡</text>
      </view>
      <view 
        class="tab-item {{activeTab === 'completed' ? 'active' : ''}}" 
        bindtap="switchTab" 
        data-tab="completed"
      >
        <text class="tab-text">å·²å®Œæˆä»»åŠ¡</text>
      </view>
    </view>

    <!-- å¾…å®Œæˆä»»åŠ¡åˆ—è¡¨ -->
    <view class="task-list" wx:if="{{activeTab === 'todo'}}">
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <view wx:elif="{{tasks.length > 0}}">
        <view class="task-item" wx:for="{{tasks}}" wx:key="id">
          <view class="task-content">
            <view class="task-header">
              <text class="task-title">{{item.title}}</text>
              <text class="task-reward">+Â¥{{item.reward}}</text>
            </view>
            <text class="task-description" wx:if="{{item.description}}">{{item.description}}</text>
            <view class="task-footer">
              <text class="task-deadline">æˆªæ­¢: {{item.deadline}}</text>
              <view class="task-actions">
                <button class="btn-complete" size="mini" bindtap="completeTask" data-id="{{item.id}}">
                  å®Œæˆ
                </button>
                <button class="btn-delete" size="mini" type="warn" bindtap="deleteTask" data-id="{{item.id}}" data-tab="todo">
                  åˆ é™¤
                </button>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="empty-state">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">æš‚æ— å¾…å®Œæˆä»»åŠ¡</text>
      </view>
    </view>

    <!-- å·²å®Œæˆä»»åŠ¡åˆ—è¡¨ -->
    <view class="task-list" wx:if="{{activeTab === 'completed'}}">
      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <view wx:elif="{{completedTasks.length > 0}}">
        <view class="task-item completed" wx:for="{{completedTasks}}" wx:key="id">
          <view class="task-content">
            <view class="task-header">
              <text class="task-title">{{item.title}}</text>
              <text class="task-reward">+Â¥{{item.reward}}</text>
            </view>
            <text class="task-description" wx:if="{{item.description}}">{{item.description}}</text>
            <view class="task-footer">
              <text class="task-complete-time">å®Œæˆäº: {{item.completeTime}}</text>
              <button class="btn-delete" size="mini" type="warn" bindtap="deleteTask" data-id="{{item.id}}" data-tab="completed">
                åˆ é™¤
              </button>
            </view>
          </view>
          <view class="task-check">âœ“</view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:else class="empty-state">
        <text class="empty-icon">ğŸ†</text>
        <text class="empty-text">æš‚æ— å·²å®Œæˆä»»åŠ¡</text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ ä»»åŠ¡æŒ‰é’® -->
  <button class="add-task-btn" bindtap="openAddModal" wx:if="{{activeTab === 'todo'}}">
    <text class="add-icon">+</text>
  </button>

  <!-- æ·»åŠ ä»»åŠ¡å¯¹è¯æ¡† -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="closeAddModal"></view>
  <view class="modal-content" wx:if="{{showAddModal}}">
    <view class="modal-header">
      <text class="modal-title">æ·»åŠ ä»»åŠ¡</text>
      <text class="modal-close" bindtap="closeAddModal">Ã—</text>
    </view>
    
    <view class="modal-body">
      <view class="form-group">
        <text class="form-label">ä»»åŠ¡åç§° *</text>
        <input 
          type="text" 
          placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°" 
          value="{{newTask.title}}"
          bindinput="inputTaskInfo"
          data-field="title"
          class="form-input" 
        />
      </view>
      
      <view class="form-group">
        <text class="form-label">å¥–åŠ±é‡‘é¢ *</text>
        <input 
          type="digit" 
          placeholder="0.00" 
          value="{{newTask.reward}}"
          bindinput="inputTaskInfo"
          data-field="reward"
          class="form-input" 
        />
      </view>
      
      <view class="form-group">
        <text class="form-label">ä»»åŠ¡æè¿°</text>
        <textarea 
          placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°" 
          value="{{newTask.description}}"
          bindinput="inputTaskInfo"
          data-field="description"
          class="form-textarea" 
          auto-height
        ></textarea>
      </view>
      
      <view class="form-group">
        <text class="form-label">æˆªæ­¢æ—¥æœŸ *</text>
        <input 
          type="date" 
          value="{{newTask.deadline}}"
          bindinput="inputTaskInfo"
          data-field="deadline"
          class="form-input" 
        />
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="closeAddModal">å–æ¶ˆ</button>
      <button class="btn-confirm" type="primary" bindtap="addTask">ç¡®å®š</button>
    </view>
  </view>
</view>